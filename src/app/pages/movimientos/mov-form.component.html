<div class="card text-white mb-3" [ngClass]="{'bg-success': tipoMovimiento == 1,
    'bg-danger': tipoMovimiento == 2}">
  <div class="card-header p-2 text-center">
    <div class="d-flex flex-row" *ngIf="tipoMovimiento == 1; else elseBlock">
      <h3 class="ml-3">INGRESOS</h3>
      <button class="btn btn-secondary ml-auto" (click)="form = !form">Nuevo Ingreso</button>
    </div>
    <ng-template #elseBlock>
      <div class="d-flex flex-row">
        <h3 class="ml-3">SALIDAS</h3>
        <button class="btn btn-secondary ml-auto" (click)="form = !form">Nueva Salida</button>
      </div>
    </ng-template>

  </div>
  <div class="card-body bg-white text-dark table-responsive p-1">
    <form *ngIf="form" (ngSubmit)="registrar()">
      <!-- campo autocomplete -->
      <div class="ng-autocomplete" style="width: 100%;">
        <ng-autocomplete
            class="ml-2"
            [data]="productos"
            [placeHolder]="placeholder"
            [searchKeyword]="keyword"
            (selected)='selectEvent($event)'
            (inputChanged)='onChangeSearch($event)'
            (inputFocused)='onFocused($event)'
            [itemTemplate]="itemTemplate"
            [notFoundTemplate]="notFoundTemplate"
            #auto>
        </ng-autocomplete>
        <ng-template #itemTemplate let-item>
          <a [innerHTML]="item.nombre"></a>
        </ng-template>

        <ng-template #notFoundTemplate let-notFound>
          <div [innerHTML]="noPro"></div>
        </ng-template>
      </div>
      <table class="table mt-3 w-100">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Importe</th>
            <th colspan="2">Subtotal</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let prod of addProductos">
            <td>
              {{ prod.nombre }}
            </td>
            <td>
              <input type="text" class="form-control text-center"  size="2" name="num" [(ngModel)]="prod.num" [ngModelOptions]="{standalone: true}" (keyup)="calcularSubtotal(prod)">
            </td>
            <td>
              <input type="text" class="form-control text-center" name="importe" [(ngModel)]="prod.importe" [ngModelOptions]="{standalone: true}" (keyup)="calcularSubtotal(prod)" size="2">
            </td>
            <td>
              <input type="text" class="form-control text-center" name="subtotal" [(ngModel)]="prod.subtotal" [ngModelOptions]="{standalone: true}" readonly size="2">
            </td>
            <td>
              <button class="btn btn-danger btn-sm" (click)="quitarProducto(prod)"><i class="fa fa-trash"></i></button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3">TOTAL</td>
            <td class="text-center">{{ total }}</td>
          </tr>
        </tfoot>
      </table>
      <div class="form-group">
        <label for="observacion">Observaciones</label>
        <textarea class="form-control" id="observacion" rows="4" name="observaciones" [(ngModel)]="observaciones"></textarea>
      </div>

      <div *ngIf="tipoMovimiento == 1; else btnSalida">
        <button type="submit" class="btn btn-primary btn-block" (click)="tipoMovimiento = 1">Dar ingreso</button>
      </div>
      <ng-template #btnSalida>
        <button type="submit" class="btn btn-warning btn-block" (click)="tipoMovimiento = 2">Dar salida</button>
      </ng-template>
      <input type="hidden" />

    </form>
  </div>
  <div class="card-footer bg-info text-dark p-1  table-responsive">
    <div *ngIf="tipoMovimiento == 1; else ultimos">
      <h5 class="card-title">Últimos ingresos</h5>
    </div>
    <ng-template #ultimos>
      <h5 class="card-title">Últimas salidas</h5>
    </ng-template>
    <table class="table table-bordered bg-light w-100">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Importe</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Cerveza Cusqueña</td>
          <td>2</td>
          <td>3</td>
          <td>4</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
